<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Painel de An√°lise de Desempenho - Provas I & II</title>

    <!-- Carrega o Tailwind CSS para estiliza√ß√£o moderna e responsiva -->

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Define a fonte Inter e cores prim√°rias -->

    <style>

        :root {

            --color-primary: #3b82f6; /* blue-500 */

            --color-success: #10b981; /* emerald-500 */

            --color-danger: #ef4444; /* red-500 */

        }

        body {

            font-family: 'Inter', sans-serif;

            background-color: #f3f4f6; /* bg-gray-100 */

        }

        .evolution-positive {

            color: var(--color-success);

        }

        .evolution-negative {

            color: var(--color-danger);

        }

        .evolution-neutral {

            color: #4b5563; /* gray-600 */

        }

        .scrollable-table {

            max-height: 70vh; /* Limita a altura para melhor visualiza√ß√£o em telas pequenas */

            overflow-y: auto;

        }

        /* Estilos de barra de progresso para o gr√°fico */

        .bar-container {

            height: 1.5rem;

            background-color: #e5e7eb;

            border-radius: 0.5rem;

            overflow: hidden;

            margin-bottom: 0.5rem;

        }

        .bar-progress {

            height: 100%;

            background-color: var(--color-primary);

            transition: width 0.5s ease-out;

            display: flex;

            align-items: center;

            padding-left: 0.5rem;

            color: white;

            font-weight: bold;

            font-size: 0.75rem;

        }

    </style>

</head>

<body class="p-4 md:p-8">

 

    <header class="mb-8">

        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 border-b-4 border-blue-500 pb-2">

            üìä An√°lise Comparativa de Desempenho

        </h1>

        <p class="text-gray-600 text-lg">

            Compara√ß√£o das notas (Nota I vs. Nota II) e m√©tricas de evolu√ß√£o dos alunos.

        </p>

    </header>

 

    <!-- Indicador de Carregamento/Erros -->

    <div id="loading-indicator" class="text-center p-8 bg-white rounded-xl shadow-lg mb-8">

        <p class="text-xl font-semibold text-blue-600">

            Processando dados... Aguarde um momento.

        </p>

    </div>

 

    <!-- Se√ß√£o de Resumo (Cards) -->

    <div id="summary-section" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12 hidden">

        <!-- Cards ser√£o injetados aqui -->

    </div>

 

    <!-- Se√ß√£o de Gr√°fico de Turmas -->

    <div class="bg-white p-6 rounded-xl shadow-lg mb-12 hidden" id="chart-section">

        <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">Evolu√ß√£o M√©dia de Nota por Turma</h2>

        <div id="class-chart-container">

            <!-- Gr√°fico de evolu√ß√£o de turmas ser√° injetado aqui -->

        </div>

        <p class="text-sm text-gray-500 mt-4">

            *A evolu√ß√£o √© calculada como: M√©dia da Nota II - M√©dia da Nota I (turmas que n√£o participaram em ambas as provas podem ter NaNs).

        </p>

    </div>

 

    <!-- Se√ß√£o de Tabela de Dados Completa -->

    <div class="bg-white p-6 rounded-xl shadow-lg">

        <h2 class="text-2xl font-bold text-gray-800 mb-4">Tabela Completa de Desempenho</h2>

        <div class="scrollable-table shadow-inner rounded-lg">

            <table class="min-w-full divide-y divide-gray-200">

                <thead class="bg-gray-50 sticky top-0">

                    <tr id="table-header">

                        <!-- Cabe√ßalho ser√° injetado aqui -->

                    </tr>

                </thead>

                <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">

                    <!-- Dados da tabela ser√£o injetados aqui -->

                </tbody>

            </table>

        </div>

    </div>

 

    <script>

        // ==============================================================================

        // 1. DADOS BRUTOS (Strings CSV id√™nticas √†s usadas na codifica√ß√£o Python)

        // ==============================================================================

 

        const data_3A_I = `Primeira avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nANA CAROLINA FERNANDES DE SANTANA,A,-,-,-,NC\nANA CLARA GOMES DE SOUZA,A,9,4.5,Elementar II,0.45\nANA ELOISE OLIVEIRA DA SILVA,A,8,4,Elementar I,0.4\nANDERSON CAVALCANTI DA SILVA,A,9,4.5,Elementar II,0.45\nBIANKA HEVELIN NASCIMENTO DA SILVA,A,-,-,-,NC\nBRENDA SAFIRA GUSTAVO DA SILVA SANTOS,A,5,2.5,Elementar I,0.25\nCAYLANE DE OLIVEIRA PAZ,A,6,3,Elementar I,0.3\nEDUARDA ALVES DA SILVA,A,7,3.5,Elementar I,0.35\nELISON QUEIROZ ALVES DA SILVA,A,3,1.5,Elementar I,0.15\nESTER SEVERINA DE FREITAS,A,6,3,Elementar I,0.3\nEVELLYN VIEIRA FRANCA DA SILVA,A,6,3,Elementar I,0.3\nGABRIEL DOS SANTOS OLIVEIRA,A,-,-,-,NC\nJACKSON GABRIEL BATISTA SANTOS,A,6,3,Elementar I,0.3\nJAMERSON GAMA DA SILVA,A,-,-,-,NC\nJAYWANNY VITORIA SANTOS DA HORA,A,8,4,Elementar I,0.4\nJOANA EVELYN NASCIMENTO LACERDA,A,3,1.5,Elementar I,0.15\nJOAO VINICIUS GOMES DE SOUZA,A,9,4.5,Elementar II,0.45\nJULIA YASMMYM RIBEIRO DE ANDRADE,A,-,-,-,NC\nKAMILLY BEZERRA DE ANDRADE,A,-,-,-,NC\nKELPS CARLOS PRAXEDES RICHENNE,A,6,3,Elementar I,0.3\nKETILLY BEZERRA DE ANDRADE,A,-,-,-,NC\nLAIS VITORIA DA SILVA,A,7,3.5,Elementar I,0.35\nMARIA IZABEL FERREIRA COSTA,A,8,4,Elementar I,0.4\nMARY ANNE DA SILVA SANTOS,A,9,4.5,Elementar II,0.45\nMIKAEL CARLOS DA SILVA FARIAS,A,7,3.5,Elementar I,0.35\nSARA EVELYN NASCIMENTO DE PAULA,A,8,4,Elementar I,0.4\nSHEILLA BEATRIZ DA SILVA BARRETO,A,9,4.5,Elementar II,0.45\n`;

        const data_3A_II = `Segunda avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nANA CAROLINA FERNANDES DE SANTANA,A,-,-,-,NC\nANA CLARA GOMES DE SOUZA,A,9,4.5,Elementar II,0.45\nANA ELOISE OLIVEIRA DA SILVA,A,7,3.5,Elementar I,0.35\nANDERSON CAVALCANTI DA SILVA,A,8,4,Elementar I,0.4\nBIANKA HEVELIN NASCIMENTO DA SILVA,A,-,-,-,NC\nBRENDA SAFIRA GUSTAVO DA SILVA SANTOS,A,4,2,Elementar I,0.2\nCAYLANE DE OLIVEIRA PAZ,A,5,2.5,Elementar I,0.25\nEDUARDA ALVES DA SILVA,A,9,4.5,Elementar II,0.45\nELISON QUEIROZ ALVES DA SILVA,A,5,2.5,Elementar I,0.25\nESTER SEVERINA DE FREITAS,A,4,2,Elementar I,0.2\nEVELLYN VIEIRA FRANCA DA SILVA,A,6,3,Elementar I,0.3\nGABRIEL DOS SANTOS OLIVEIRA,A,1,0.5,Elementar I,0.05\nJACKSON GABRIEL BATISTA SANTOS,A,4,2,Elementar I,0.2\nJAMERSON GAMA DA SILVA,A,-,-,-,NC\nJAYWANNY VITORIA SANTOS DA HORA,A,10,5,Elementar II,0.5\nJOANA EVELYN NASCIMENTO LACERDA,A,5,2.5,Elementar I,0.25\nJOAO VINICIUS GOMES DE SOUZA,A,8,4,Elementar I,0.4\nJULIA YASMMYM RIBEIRO DE ANDRADE,A,6,3,Elementar I,0.3\nKAMILLY BEZERRA DE ANDRADE,A,-,-,-,NC\nKELPS CARLOS PRAXEDES RICHENNE,A,-,-,-,NC\nKETILLY BEZERRA DE ANDRADE,A,-,-,-,NC\nLAIS VITORIA DA SILVA,A,5,2.5,Elementar I,0.25\nMARIA IZABEL FERREIRA COSTA,A,9,4.5,Elementar II,0.45\nMARY ANNE DA SILVA SANTOS,A,8,4,Elementar I,0.4\nMIKAEL CARLOS DA SILVA FARIAS,A,8,4,Elementar I,0.4\nSARA EVELYN NASCIMENTO DE PAULA,A,9,4.5,Elementar II,0.45\nSHEILLA BEATRIZ DA SILVA BARRETO,A,8,4,Elementar I,0.4\n`;

        const data_3B_I = `Primeira avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nANA BEATRIZ TEIXEIRA DE MENEZES,B,-,-,-,NC\nARTHUR GUTEMBERG DOS SANTOS DE OLIVEIRA,B,3,1.5,Elementar I,0.15\nBARBARA LUIZA SILVA DOS SANTOS,B,-,-,-,NC\nBRENDO DA SILVA NUNES,B,5,2.5,Elementar I,0.25\nDENILSON GUILHERME DOS SANTOS LINS,B,5,2.5,Elementar I,0.25\nELLEN EWELLIN SIQUEIRA DA SILVA,B,7,3.5,Elementar I,0.35\nELOYSA PAMELA FIRMINO DA HORA SILVA,B,-,-,-,NC\nEMILLY HELEN LEITE DOS SANTOS,B,6,3,Elementar I,0.3\nEVELYN VITORIA FERREIRA CAVALCANTE,B,3,1.5,Elementar I,0.15\nGIOVANA VITORIA DA SILVA COLHADO,B,3,1.5,Elementar I,0.15\nGUSTAVO MARQUES DE LIMA ABREU,B,4,2,Elementar I,0.2\nJEFFERSON JOSE DE MELO JUNIOR,B,3,1.5,Elementar I,0.15\nJOAO GABRIEL GOMES DA SILVA,B,4,2,Elementar I,0.2\nJONY MATEUS SOUZA DE OLIVEIRA,B,3,1.5,Elementar I,0.15\nJOSE MIGUEL CANUTO DA SILVA,B,9,4.5,Elementar II,0.45\nKAUA LUCAS ALEXANDRE DO CARMO,B,5,2.5,Elementar I,0.25\nMARIA CLARA DOS SANTOS,B,7,3.5,Elementar I,0.35\nMARIA EDUARDA DE LIMA BARBOSA,B,6,3,Elementar I,0.3\nMARY LUANA FERREIRA DA SILVA,B,8,4,Elementar I,0.4\nREBECA VITORIA DE OLIVEIRA,B,5,2.5,Elementar I,0.25\nVITORIA REBECA DA SILVA,B,6,3,Elementar I,0.3\n`;

        const data_3B_II = `Segunda avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nANA BEATRIZ TEIXEIRA DE MENEZES,B,3,1.5,Elementar I,0.15\nARTHUR GUTEMBERG DOS SANTOS DE OLIVEIRA,B,9,4.5,Elementar II,0.45\nBARBARA LUIZA SILVA DOS SANTOS,B,-,-,-,NC\nBRENDO DA SILVA NUNES,B,4,2,Elementar I,0.2\nDENILSON GUILHERME DOS SANTOS LINS,B,6,3,Elementar I,0.3\nELLEN EWELLIN SIQUEIRA DA SILVA,B,-,-,-,NC\nELOYSA PAMELA FIRMINO DA HORA SILVA,B,6,3,Elementar I,0.3\nEMILLY HELEN LEITE DOS SANTOS,B,-,-,-,NC\nEVELYN VITORIA FERREIRA CAVALCANTE,B,4,2,Elementar I,0.2\nGIOVANA VITORIA DA SILVA COLHADO,B,3,1.5,Elementar I,0.15\nGUSTAVO MARQUES DE LIMA ABREU,B,-,-,-,NC\nJEFFERSON JOSE DE MELO JUNIOR,B,-,-,-,NC\nJOAO GABRIEL GOMES DA SILVA,B,3,1.5,Elementar I,0.15\nJONY MATEUS SOUZA DE OLIVEIRA,B,-,-,-,NC\nJOSE MIGUEL CANUTO DA SILVA,B,8,4,Elementar I,0.4\nKAUA LUCAS ALEXANDRE DO CARMO,B,6,3,Elementar I,0.3\nMARIA CLARA DOS SANTOS,B,8,4,Elementar I,0.4\nMARIA EDUARDA DE LIMA BARBOSA,B,7,3.5,Elementar I,0.35\nMARY LUANA FERREIRA DA SILVA,B,9,4.5,Elementar II,0.45\nREBECA VITORIA DE OLIVEIRA,B,5,2.5,Elementar I,0.25\nVITORIA REBECA DA SILVA,B,7,3.5,Elementar I,0.35\n`;

        const data_3C_I = `Primeira avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nALEXSANDER CAIO MOURA SOUZA,C,4,2,Elementar I,0.2\nALLAN PEREIRA DA SILVA,C,7,3.5,Elementar I,0.35\nALYNE GABRYELLE MATIAS DE SIQUEIRA,C,3,1.5,Elementar I,0.15\nANA JULIA DA SILVA RODRIGUES,C,6,3,Elementar I,0.3\nANDREI VICTOR DE BARROS,C,2,1,Elementar I,0.1\nANDRELAINE MARIA DA SILVA SANTOS,C,1,0.5,Elementar I,0.05\nCAIO DE MELO CORREIA,C,5,2.5,Elementar I,0.25\nCAMILE VITORIA BANDEIRA DA SILVA,C,5,2.5,Elementar I,0.25\nCARLOS WESLEY DA SILVA MOURA CAVALCANTI,C,2,1,Elementar I,0.1\nDHENNYFFER BEATRYZ FREITAS DE SANTANA,C,4,2,Elementar I,0.2\nERINALDO LIMA FERREIRA DOS SANTOS,C,7,3.5,Elementar I,0.35\nGABRIEL RENAN PEREIRA DE SANTANA,C,4,2,Elementar I,0.2\nGABRIEL VICTOR BEZERRA DA SILVA,C,2,1,Elementar I,0.1\nGEOVANNA ROQUE DA SILVA,C,2,1,Elementar I,0.1\nIZABELE FLORENCIO DE SANTANA,C,8,4,Elementar I,0.4\nJEFERSSON MAGNO CAVALCANTI DA SILVA,C,5,2.5,Elementar I,0.25\nJEREMIAS DA SILVA OLIVEIRA,C,-,-,-,NC\nJOAO PEDRO SABINO AZEVEDO DA SILVA,C,8,4,Elementar I,0.4\nJOAO VICTOR GOMES DE LIMA,C,6,3,Elementar I,0.3\nJOSE VALDEMIR DE SOUZA,C,4,2,Elementar I,0.2\n`;

        const data_3C_II = `Segunda avalia√ß√£o da IA,,,,,\nNome_Completo,Turma,Acertos Simulado MT,Nota Simulado MT,Situa√ß√£o MT,Porcentagens\nALEXSANDER CAIO MOURA SOUZA,C,-,-,-,NC\nALLAN PEREIRA DA SILVA,C,-,-,-,NC\nALYNE GABRYELLE MATIAS DE SIQUEIRA,C,4,2,Elementar I,0.2\nANA JULIA DA SILVA RODRIGUES,C,3,1.5,Elementar I,0.15\nANDREI VICTOR DE BARROS,C,4,2,Elementar I,0.2\nANDRELAINE MARIA DA SILVA SANTOS,C,-,-,-,NC\nCAIO DE MELO CORREIA,C,5,2.5,Elementar I,0.25\nCAMILE VITORIA BANDEIRA DA SILVA,C,-,-,-,NC\nCARLOS WESLEY DA SILVA MOURA CAVALCANTI,C,2,1,Elementar I,0.1\nDHENNYFFER BEATRYZ FREITAS DE SANTANA,C,4,2,Elementar I,0.2\nERINALDO LIMA FERREIRA DOS SANTOS,C,-,-,-,NC\nGABRIEL RENAN PEREIRA DE SANTANA,C,6,3,Elementar I,0.3\nGABRIEL VICTOR BEZERRA DA SILVA,C,5,2.5,Elementar I,0.25\nGEOVANNA ROQUE DA SILVA,C,8,4,Elementar I,0.4\nIZABELE FLORENCIO DE SANTANA,C,-,-,-,NC\nJEFERSSON MAGNO CAVALCANTI DA SILVA,C,7,3.5,Elementar I,0.35\nJEREMIAS DA SILVA OLIVEIRA,C,5,2.5,Elementar I,0.25\nJOAO PEDRO SABINO AZEVEDO DA SILVA,C,9,4.5,Elementar II,0.45\nJOAO VICTOR GOMES DE LIMA,C,7,3.5,Elementar I,0.35\nJOSE VALDEMIR DE SOUZA,C,5,2.5,Elementar I,0.25\n`;

 

        const allRawData = [

            { csv: data_3A_I, prova: 'I' }, { csv: data_3A_II, prova: 'II' },

            { csv: data_3B_I, prova: 'I' }, { csv: data_3B_II, prova: 'II' },

            { csv: data_3C_I, prova: 'I' }, { csv: data_3C_II, prova: 'II' },

        ];

 

        let finalData = [];

        let sortColumn = 'Media_Individual';

        let sortDirection = 'desc';

 

        // ==============================================================================

        // 2. FUN√á√ïES DE PROCESSAMENTO DE DADOS (JS Data Manipulation)

        // ==============================================================================

 

        /**

         * Converte uma string CSV em um array de objetos.

         * @param {string} csvString - A string CSV.

         * @returns {Array<Object>} Array de objetos com os dados.

         */

        function parseCSV(csvString) {

            const lines = csvString.trim().split('\n');

            // Ignora a linha de coment√°rio e pega o cabe√ßalho

            const header = lines[1].split(',');

            const dataLines = lines.slice(2);

 

            return dataLines.map(line => {

                const values = line.split(',');

                const obj = {};

                header.forEach((key, i) => {

                    const cleanedKey = key.trim().replace(/ /g, '_'); // Nome_Completo, Turma, Nota_Simulado_MT, etc.

                    obj[cleanedKey] = values[i].trim();

                });

                return obj;

            });

        }

 

        /**

         * Consolida todos os dados em um √∫nico array de objetos e calcula as m√©tricas.

         */

        function processData() {

            const consolidatedMap = new Map();

 

            allRawData.forEach(({ csv, prova }) => {

                const parsedData = parseCSV(csv);

               

                parsedData.forEach(aluno => {

                    const key = `${aluno.Nome_Completo}|${aluno.Turma}`;

                    let record = consolidatedMap.get(key) || {

                        Nome_Completo: aluno.Nome_Completo,

                        Turma: aluno.Turma,

                        Nota_I: null, Acertos_I: null,

                        Nota_II: null, Acertos_II: null

                    };

 

                    // Limpa e converte valores

                    const notaRaw = aluno.Nota_Simulado_MT;

                    const acertosRaw = aluno.Acertos_Simulado_MT;

                   

                    const nota = (notaRaw && notaRaw !== '-' && notaRaw !== 'NC') ? parseFloat(notaRaw) : null;

                    const acertos = (acertosRaw && acertosRaw !== '-' && acertosRaw !== 'NC') ? parseInt(acertosRaw, 10) : null;

 

                    record[`Nota_${prova}`] = nota;

                    record[`Acertos_${prova}`] = acertos;

 

                    consolidatedMap.set(key, record);

                });

            });

 

            let finalRecords = Array.from(consolidatedMap.values());

 

            // 1. C√°lculo da M√©dia Individual, Evolu√ß√£o e Ranking

            finalRecords.forEach(aluno => {

                const n1 = aluno.Nota_I !== null ? aluno.Nota_I : 0;

                const n2 = aluno.Nota_II !== null ? aluno.Nota_II : 0;

                const a1 = aluno.Acertos_I !== null ? aluno.Acertos_I : 0;

                const a2 = aluno.Acertos_II !== null ? aluno.Acertos_II : 0;

 

                // Evolu√ß√£o

                aluno.Evolucao_Nota = n2 - n1;

                aluno.Evolucao_Acertos = a2 - a1;

 

                // M√©dia Individual (apenas para quem tem pelo menos 1 nota)

                let sum = 0;

                let count = 0;

                if (aluno.Nota_I !== null) { sum += aluno.Nota_I; count++; }

                if (aluno.Nota_II !== null) { sum += aluno.Nota_II; count++; }

 

                aluno.Media_Individual = count > 0 ? sum / count : null;

            });

 

            // 2. C√°lculo do Rank Geral

            // Ordena pelo Media_Individual (desc) para atribuir rank

            finalRecords.sort((a, b) => (b.Media_Individual || -1) - (a.Media_Individual || -1));

           

            let currentRank = 1;

            let lastScore = null;

           

            finalRecords.forEach((aluno, index) => {

                // Se a nota for nula, rank √© nulo.

                if (aluno.Media_Individual === null) {

                    aluno.Rank_Geral = null;

                } else {

                    // Se a nota for igual √† anterior, mant√©m o rank

                    if (index > 0 && aluno.Media_Individual === finalRecords[index - 1].Media_Individual) {

                        aluno.Rank_Geral = finalRecords[index - 1].Rank_Geral;

                    } else {

                        // Novo rank √© a posi√ß√£o + 1

                        aluno.Rank_Geral = index + 1;

                    }

                }

            });

 

            // 3. C√°lculo das M√©dias e Evolu√ß√£o por Turma

            const classData = {};

           

            finalRecords.forEach(aluno => {

                if (!classData[aluno.Turma]) {

                    classData[aluno.Turma] = { countI: 0, sumI: 0, countII: 0, sumII: 0, totalStudents: 0 };

                }

                classData[aluno.Turma].totalStudents++;

 

                if (aluno.Nota_I !== null) {

                    classData[aluno.Turma].sumI += aluno.Nota_I;

                    classData[aluno.Turma].countI++;

                }

                if (aluno.Nota_II !== null) {

                    classData[aluno.Turma].sumII += aluno.Nota_II;

                    classData[aluno.Turma].countII++;

                }

            });

 

            const classResults = Object.keys(classData).map(turma => {

                const data = classData[turma];

                const mediaI = data.countI > 0 ? data.sumI / data.countI : null;

                const mediaII = data.countII > 0 ? data.sumII / data.countII : null;

                const evolucao = (mediaII !== null && mediaI !== null) ? mediaII - mediaI : null;

 

                return {

                    Turma: `3¬∫ Ano ${turma}`,

                    Media_I: mediaI,

                    Media_II: mediaII,

                    Evolucao_Turma: evolucao,

                    Total_Alunos: data.totalStudents

                };

            }).sort((a, b) => a.Turma.localeCompare(b.Turma)); // Ordena por nome da turma

 

            return { finalRecords, classResults };

        }

 

        // ==============================================================================

        // 3. FUN√á√ïES DE RENDERIZA√á√ÉO

        // ==============================================================================

 

        /**

         * Gera a classe de cor e o √≠cone para a evolu√ß√£o.

         */

        function getEvolutionClass(value) {

            if (value > 0.05) { // Evolu√ß√£o positiva significativa

                return { class: 'evolution-positive', icon: '‚Üë' };

            } else if (value < -0.05) { // Evolu√ß√£o negativa significativa

                return { class: 'evolution-negative', icon: '‚Üì' };

            } else {

                return { class: 'evolution-neutral', icon: '‚Üî' };

            }

        }

 

        /**

         * Renderiza o painel de resumo (cards).

         */

        function renderSummary(records, classResults) {

            const summarySection = document.getElementById('summary-section');

            summarySection.innerHTML = '';

            summarySection.classList.remove('hidden');

 

            const totalScores = records.filter(r => r.Media_Individual !== null);

            const overallAvg = totalScores.reduce((sum, r) => sum + r.Media_Individual, 0) / totalScores.length;

 

            const bestEvolver = totalScores.reduce((best, current) => {

                // Apenas alunos que fizeram as duas provas

                if (current.Nota_I !== null && current.Nota_II !== null && current.Evolucao_Nota > (best ? best.Evolucao_Nota : -Infinity)) {

                    return current;

                }

                return best;

            }, null);

 

            const bestClass = classResults.reduce((best, current) => {

                if (current.Evolucao_Turma !== null && current.Evolucao_Turma > (best ? best.Evolucao_Turma : -Infinity)) {

                    return current;

                }

                return best;

            }, null);

 

            const worstClass = classResults.reduce((worst, current) => {

                if (current.Evolucao_Turma !== null && current.Evolucao_Turma < (worst ? worst.Evolucao_Turma : Infinity)) {

                    return current;

                }

                return worst;

            }, null);

 

            // Fun√ß√£o helper para card

            const createCard = (title, value, subtitle, valueClass = 'text-gray-900') => `

                <div class="bg-white p-5 rounded-xl shadow-lg border-l-4 border-blue-500">

                    <p class="text-sm font-medium text-gray-500 truncate">${title}</p>

                    <div class="mt-1 flex items-baseline">

                        <span class="text-2xl font-semibold ${valueClass}">${value}</span>

                        ${subtitle ? `<span class="ml-2 text-sm font-medium text-gray-500">${subtitle}</span>` : ''}

                    </div>

                </div>

            `;

 

            // Card 1: M√©dia Geral

            summarySection.innerHTML += createCard(

                'M√©dia Geral (Provas I & II)',

                overallAvg ? overallAvg.toFixed(2) : 'N/D',

                'de todos os participantes'

            );

 

            // Card 2: Melhor Evolu√ß√£o (Aluno)

            const evolverClass = bestEvolver ? getEvolutionClass(bestEvolver.Evolucao_Nota).class : 'text-gray-900';

            summarySection.innerHTML += createCard(

                'Melhor Evolu√ß√£o Individual',

                bestEvolver ? `+${bestEvolver.Evolucao_Nota.toFixed(2)}` : 'N/D',

                bestEvolver ? `${bestEvolver.Nome_Completo}` : '',

                evolverClass

            );

           

            // Card 3: Turma com Maior Crescimento

            const bestClassEvol = bestClass ? bestClass.Evolucao_Turma : null;

            const bestClassValueClass = bestClassEvol && bestClassEvol > 0 ? 'evolution-positive' : 'evolution-neutral';

 

            summarySection.innerHTML += createCard(

                'Maior Crescimento (Turma)',

                bestClass ? `+${bestClass.Evolucao_Turma.toFixed(2)}` : 'N/D',

                bestClass ? `${bestClass.Turma}` : '',

                bestClassValueClass

            );

 

            // Card 4: Turma com Menor Crescimento / Maior Queda

            const worstClassEvol = worstClass ? worstClass.Evolucao_Turma : null;

            const worstClassValueClass = worstClassEvol && worstClassEvol < 0 ? 'evolution-negative' : 'text-gray-900';

            summarySection.innerHTML += createCard(

                'Maior Queda (Turma)',

                worstClass ? `${worstClass.Evolucao_Turma.toFixed(2)}` : 'N/D',

                worstClass ? `${worstClass.Turma}` : '',

                worstClassValueClass

            );

        }

 

        /**

         * Renderiza o gr√°fico de evolu√ß√£o de turmas.

         */

        function renderChart(classResults) {

            const chartContainer = document.getElementById('class-chart-container');

            const chartSection = document.getElementById('chart-section');

            chartContainer.innerHTML = '';

            chartSection.classList.remove('hidden');

 

            const maxAbsEvol = Math.max(...classResults.map(c => Math.abs(c.Evolucao_Turma || 0)), 0.01); // Evita divis√£o por zero

 

            classResults.forEach(c => {

                const evolucao = c.Evolucao_Turma;

                const progress = Math.abs(evolucao || 0) / maxAbsEvol * 100;

               

                let barClass = 'bg-gray-400';

                let evolText = 'N/D';

 

                if (evolucao !== null) {

                    if (evolucao > 0) {

                        barClass = 'bg-emerald-500';

                        evolText = `+${evolucao.toFixed(2)}`;

                    } else if (evolucao < 0) {

                        barClass = 'bg-red-500';

                        evolText = `${evolucao.toFixed(2)}`;

                    } else {

                        barClass = 'bg-blue-400';

                        evolText = evolucao.toFixed(2);

                    }

                }

               

                const barHtml = `

                    <div class="flex items-center mb-4">

                        <div class="w-1/4 font-semibold text-gray-700">${c.Turma}</div>

                        <div class="w-3/4 bar-container">

                            <div class="bar-progress ${barClass} shadow-md" style="width: ${progress}%;">

                                ${evolText}

                            </div>

                        </div>

                    </div>

                `;

                chartContainer.innerHTML += barHtml;

            });

        }

 

 

        /**

         * Renderiza a tabela de desempenho completa.

         */

        function renderTable(records) {

            const tableBody = document.getElementById('data-table-body');

            const tableHeader = document.getElementById('table-header');

            tableBody.innerHTML = '';

            tableHeader.innerHTML = '';

 

            const columns = [

                { key: 'Rank_Geral', label: 'Rank', sortable: true, align: 'right' },

                { key: 'Nome_Completo', label: 'Nome Completo', sortable: true, align: 'left' },

                { key: 'Turma', label: 'Turma', sortable: true, align: 'center' },

                { key: 'Nota_I', label: 'Nota I', sortable: true, align: 'right' },

                { key: 'Nota_II', label: 'Nota II', sortable: true, align: 'right' },

                { key: 'Media_Individual', label: 'M√©dia Ind.', sortable: true, align: 'right' },

                { key: 'Evolucao_Nota', label: 'Evolu√ß√£o', sortable: true, align: 'right' },

            ];

 

            // Renderiza o cabe√ßalho (com fun√ß√£o de ordena√ß√£o)

            columns.forEach(col => {

                const isCurrentSort = col.key === sortColumn;

                const directionIcon = isCurrentSort ? (sortDirection === 'asc' ? '‚ñ≤' : '‚ñº') : '‚Üî';

                const th = document.createElement('th');

                th.className = `px-4 py-3 text-${col.align} text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition duration-150 rounded-t-lg`;

               

                if (col.sortable) {

                    th.setAttribute('data-key', col.key);

                    th.addEventListener('click', () => sortTable(col.key));

                }

               

                th.innerHTML = `${col.label} ${col.sortable ? directionIcon : ''}`;

                tableHeader.appendChild(th);

            });

 

            // Aplica a ordena√ß√£o

            const sortedRecords = [...records].sort((a, b) => {

                const valA = a[sortColumn] === null ? (sortDirection === 'asc' ? Infinity : -Infinity) : a[sortColumn];

                const valB = b[sortColumn] === null ? (sortDirection === 'asc' ? Infinity : -Infinity) : b[sortColumn];

 

                if (typeof valA === 'string') {

                    return sortDirection === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);

                } else {

                    return sortDirection === 'asc' ? valA - valB : valB - valA;

                }

            });

 

            // Renderiza as linhas

            sortedRecords.forEach(aluno => {

                const tr = document.createElement('tr');

                tr.className = 'hover:bg-blue-50 transition duration-150';

 

                columns.forEach(col => {

                    const td = document.createElement('td');

                    td.className = `px-4 py-3 whitespace-nowrap text-sm text-${col.align}`;

                   

                    let content = aluno[col.key];

                    let displayValue = 'N/D';

                    let tdClass = 'text-gray-500';

 

                    if (content !== null) {

                        switch (col.key) {

                            case 'Nota_I':

                            case 'Nota_II':

                            case 'Media_Individual':

                                displayValue = content.toFixed(2);

                                tdClass = 'font-semibold text-gray-700';

                                break;

                            case 'Evolucao_Nota':

                                const evo = getEvolutionClass(content);

                                displayValue = `${evo.icon} ${content > 0 ? '+' : ''}${content.toFixed(2)}`;

                                tdClass = evo.class + ' font-bold';

                                break;

                            case 'Rank_Geral':

                                displayValue = content;

                                tdClass = 'font-extrabold text-blue-600';

                                break;

                            default:

                                displayValue = content;

                                tdClass = 'text-gray-700';

                        }

                    }

 

                    td.innerHTML = displayValue;

                    td.classList.add(tdClass);

                    tr.appendChild(td);

                });

                tableBody.appendChild(tr);

            });

        }

 

        /**

         * Lida com a ordena√ß√£o da tabela.

         */

        function sortTable(key) {

            if (sortColumn === key) {

                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';

            } else {

                sortColumn = key;

                // Valores num√©ricos (notas/rank) s√£o melhor classificados em ordem decrescente (desc) por padr√£o

                sortDirection = (['Rank_Geral', 'Media_Individual', 'Evolucao_Nota', 'Nota_I', 'Nota_II'].includes(key)) ? 'desc' : 'asc';

            }

            renderTable(finalData);

        }

 

        /**

         * Fun√ß√£o principal de inicializa√ß√£o

         */

        function initializeApp() {

            try {

                const { finalRecords, classResults } = processData();

                finalData = finalRecords;

               

                // Remove o loading

                document.getElementById('loading-indicator').classList.add('hidden');

 

                // Renderiza todas as se√ß√µes

                renderSummary(finalRecords, classResults);

                renderChart(classResults);

                sortTable(sortColumn); // Renderiza a tabela inicial (j√° ordenada por padr√£o)

 

            } catch (error) {

                console.error("Erro ao processar e renderizar os dados:", error);

                const loading = document.getElementById('loading-indicator');

                loading.innerHTML = `<p class="text-xl font-semibold text-red-600">

                                        ‚ùå Erro ao carregar os dados. Verifique o console.

                                    </p>`;

            }

        }

 

        // Inicia a aplica√ß√£o quando a janela estiver carregada

        window.onload = initializeApp;

 

    </script>

</body>

</html>
